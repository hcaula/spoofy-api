#!/usr/bin/env node

/* Change env node here */
process.env.NODE_ENV = 'local';

let start = Date.now();

const winston = require('winston');
const async = require('async');

require('../app/models/relation')();
require('../app/models/play')();
require('../app/models/user')();
require('../app/models/track')();

const configWinston = require('../config/winston').configWinston;
const initMongoose = require('../config/database').initMongoose;
const initJob = require('../app/lib/jobs').initJob;
const { request } = require('../app/lib/requests');
const { searchByField } = require('../app/lib/util');

const Track = require('mongoose').model('Track');

configWinston(function () {
    winston.info("Starting updater job.");

    initMongoose(function (error) {
        if (error) winston.error(error.stack);
        else {
            let artists = [];
            winston.info('Getting tracks for DB.');
            Track.find({}, (error, tracks) => {
                tracks.forEach(t => {
                    t.artists.forEach(a => {
                        if(!artists.includes(a.name)) artists.push(a.name);
                    });
                });

                winston.info('Dividing artists by groups of 50.');
                let mod_artists = [[]];
                let index = 0;
                artists.forEach((a, i) => {
                    if(i % 50 != 0 || i == 0) mod_artists[index].push(a);
                    else {
                        mod_artists.push([]);
                        index++;
                    }
                });
                
            });
            
        }
    });
});
